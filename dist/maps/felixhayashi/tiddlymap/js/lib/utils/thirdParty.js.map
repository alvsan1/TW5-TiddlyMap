{"version":3,"sources":["felixhayashi/tiddlymap/js/lib/utils/thirdParty.js"],"names":["generateDraftTitle","c","draftTitle","title","$tw","wiki","tiddlerExists","makeDraftTiddler","findDraft","targetTitle","getTiddler","tiddler","draftTiddler","Tiddler","getModificationFields","addTiddler","getFullScreenApis","d","document","db","body","result","webkitRequestFullscreen","undefined","mozRequestFullScreen","msRequestFullscreen","requestFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen","exitFullscreen","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","fullscreenElement","_requestFullscreen","_exitFullscreen","_fullscreenElement","flatten","target","opts","delimiter","prefix","output","step","object","prev","Object","keys","forEach","key","value","isarray","safe","Array","isArray","type","prototype","toString","call","isobject","newKey","unflatten","getkey","parsedKey","Number","isNaN","indexOf","split","key1","shift","key2","recipient","length","genUUID","CHARS","chars","uuid","rnd","r","i","Math","random","join"],"mappings":"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","file":"../../../../../../felixhayashi/tiddlymap/js/lib/utils/thirdParty.js","sourcesContent":["// @preserve\n/*\\\n\ntitle: $:/plugins/felixhayashi/tiddlymap/js/lib/utils/thirdParty\ntype: application/javascript\nmodule-type: library\n\n@preserve\n\n\\*/\n\n/**\n * Modified TW-Code from Navigator widget\n * https://github.com/Jermolene/TiddlyWiki5/blob/master/core/modules/widgets/navigator.js\n */\nexport const generateDraftTitle = title => {\n\n  let c = 0,\n    draftTitle;\n  do {\n    draftTitle = 'Draft ' + (c ? (c + 1) + ' ' : '') + 'of \\'' + title + '\\'';\n    c++;\n  } while ($tw.wiki.tiddlerExists(draftTitle));\n  return draftTitle;\n\n};\n\n/**\n * Modified TW-Code from Navigator widget\n * https://github.com/Jermolene/TiddlyWiki5/blob/master/core/modules/widgets/navigator.js\n */\nexport const makeDraftTiddler = targetTitle => {\n\n  // See if there is already a draft tiddler for this tiddler\n  let draftTitle = $tw.wiki.findDraft(targetTitle);\n  if (draftTitle) {\n    return $tw.wiki.getTiddler(draftTitle);\n  }\n  // Get the current value of the tiddler we're editing\n  const tiddler = $tw.wiki.getTiddler(targetTitle);\n  // Save the initial value of the draft tiddler\n  draftTitle = generateDraftTitle(targetTitle);\n  const draftTiddler = new $tw.Tiddler(\n      tiddler,\n    {\n      title: draftTitle,\n      'draft.title': targetTitle,\n      'draft.of': targetTitle\n    },\n      $tw.wiki.getModificationFields()\n  );\n  $tw.wiki.addTiddler(draftTiddler);\n  return draftTiddler;\n\n};\n\n/**\n * TW-Code\n * @deprecated delete this in 2016 and use $tw.utils.getFullScreenApis instead\n */\nexport const getFullScreenApis = () => {\n\n  const d = document,\n    db = d.body,\n    result = {\n      '_requestFullscreen': db.webkitRequestFullscreen !== undefined ? 'webkitRequestFullscreen' :\n              db.mozRequestFullScreen !== undefined ? 'mozRequestFullScreen' :\n              db.msRequestFullscreen !== undefined ? 'msRequestFullscreen' :\n              db.requestFullscreen !== undefined ? 'requestFullscreen' : '',\n      '_exitFullscreen': d.webkitExitFullscreen !== undefined ? 'webkitExitFullscreen' :\n              d.mozCancelFullScreen !== undefined ? 'mozCancelFullScreen' :\n              d.msExitFullscreen !== undefined ? 'msExitFullscreen' :\n              d.exitFullscreen !== undefined ? 'exitFullscreen' : '',\n      '_fullscreenElement': d.webkitFullscreenElement !== undefined ? 'webkitFullscreenElement' :\n              d.mozFullScreenElement !== undefined ? 'mozFullScreenElement' :\n              d.msFullscreenElement !== undefined ? 'msFullscreenElement' :\n              d.fullscreenElement !== undefined ? 'fullscreenElement' : '',\n      '_fullscreenChange': d.webkitFullscreenElement !== undefined ? 'webkitfullscreenchange' :\n              d.mozFullScreenElement !== undefined ? 'mozfullscreenchange' :\n              d.msFullscreenElement !== undefined ? 'MSFullscreenChange' :\n              d.fullscreenElement !== undefined ? 'fullscreenchange' : ''\n    };\n  if (!result._requestFullscreen || !result._exitFullscreen || !result._fullscreenElement) {\n    return null;\n  } else {\n    return result;\n  }\n\n};\n\n/**\n *\n * Slightly modified by me to allow an optional prefix.\n *\n * For the original code:\n *\n * Copyright (c) 2014, Hugh Kennedy, All rights reserved.\n * Code published under the BSD 3-Clause License\n *\n * @see oringal repo https://github.com/hughsk/flat\n * @see snapshot https://github.com/felixhayashi/flat\n * @see http://opensource.org/licenses/BSD-3-Clause\n */\nexport const flatten = (target, opts = {}) => {\n\n  var delimiter = opts.delimiter || '.';\n  var prefix = opts.prefix || '';\n  var output = {};\n\n  function step(object, prev) {\n    Object.keys(object).forEach(function(key) {\n      var value = object[key];\n      var isarray = opts.safe && Array.isArray(value);\n      var type = Object.prototype.toString.call(value);\n      var isobject = (\n        type === '[object Object]' ||\n        type === '[object Array]'\n      );\n\n      var newKey = prev\n        ? prev + delimiter + key\n        : prefix + key;\n\n      if (!isarray && isobject) {\n        return step(value, newKey);\n      }\n\n      output[newKey] = value;\n    });\n  }\n\n  step(target);\n\n  return output;\n\n};\n\n\n/**\n * Copyright (c) 2014, Hugh Kennedy, All rights reserved.\n * Code published under the BSD 3-Clause License\n *\n * @see oringal repo https://github.com/hughsk/flat\n * @see snapshot https://github.com/felixhayashi/flat\n * @see http://opensource.org/licenses/BSD-3-Clause\n */\nexport const unflatten = (target, opts = {}) => {\n\n  var delimiter = opts.delimiter || '.';\n  var result = {};\n\n  if (Object.prototype.toString.call(target) !== '[object Object]') {\n    return target;\n  }\n\n  // safely ensure that the key is\n  // an integer.\n  function getkey(key) {\n    var parsedKey = Number(key);\n\n    return (\n      isNaN(parsedKey) ||\n      key.indexOf('.') !== -1\n    ) ? key\n      : parsedKey;\n  }\n\n  Object.keys(target).forEach(function(key) {\n    var split = key.split(delimiter);\n    var key1 = getkey(split.shift());\n    var key2 = getkey(split[0]);\n    var recipient = result;\n\n    while (key2 !== undefined) {\n      if (recipient[key1] === undefined) {\n        recipient[key1] = (\n          typeof key2 === 'number' &&\n          !opts.object ? [] : {}\n        );\n      }\n\n      recipient = recipient[key1];\n      if (split.length > 0) {\n        key1 = getkey(split.shift());\n        key2 = getkey(split[0]);\n      }\n    }\n\n    // unflatten again for 'messy objects'\n    recipient[key1] = unflatten(target[key], opts);\n  });\n\n  return result;\n\n};\n\n\n/**\n * An adopted version of pmario's version to create\n * uuids of type RFC4122, version 4 ID.\n *\n * Shortened version:\n * pmario (1.0 - 2011.05.22):\n * http://chat-plugins.tiddlyspace.com/#UUIDPlugin\n *\n * Original version:\n * Math.uuid.js (v1.4)\n * http://www.broofa.com\n * mailto:robert@broofa.com\n *\n * Copyright (c) 2010 Robert Kieffer\n * Dual licensed under the MIT and GPL licenses.\n *\n * ---\n * @see https://github.com/almende/vis/issues/432\n*/\nexport const genUUID = (function() {\n\n  // Private array of chars to use\n  var CHARS = '0123456789abcdefghijklmnopqrstuvwxyz'.split('');\n\n  return function () {\n    var chars = CHARS, uuid = new Array(36);\n\n    var rnd=0, r;\n    for (var i = 0; i < 36; i++) {\n      if (i==8 || i==13 ||  i==18 || i==23) {\n        uuid[i] = '-';\n      } else if (i==14) {\n        uuid[i] = '4';\n      } else {\n        if (rnd <= 0x02) rnd = 0x2000000 + (Math.random()*0x1000000)|0;\n        r = rnd & 0xf;\n        rnd = rnd >> 4;\n        uuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r];\n      }\n    }\n\n    return uuid.join('');\n  };\n\n})();\n"],"sourceRoot":"../../../../../../../src/plugins"}