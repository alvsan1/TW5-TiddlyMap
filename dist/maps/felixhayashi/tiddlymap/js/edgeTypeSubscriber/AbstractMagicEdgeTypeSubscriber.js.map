{"version":3,"sources":["felixhayashi/tiddlymap/js/edgeTypeSubscriber/AbstractMagicEdgeTypeSubscriber.js"],"names":["AbstractMagicEdgeTypeSubscriber","allEdgeTypes","options","edgeTypesByFieldName","makeHashMap","id","edgeType","canHandle","name","tObj","fieldName","toWL","typeWL","refsGroupedByType","fieldNames","fields","type","toRefs","getReferencesFromField","length"],"mappings":";;;;;;;;AAWA;;;;AACA;;;;AACA;;AACA;;;;;;;;;;+eAdA;AACA;;;;;;;;;;AAeA;;;IAGMA,+B;;;AAEJ;;;AAGA,2CAAYC,YAAZ,EAA0BC,OAA1B,EAAmC;AAAA;;AAIjC;AAJiC,kKAE3BD,YAF2B,EAEbC,OAFa;;AAKjC,UAAKC,oBAAL,GAA4B,gBAAMC,WAAN,EAA5B;;AAEA,SAAK,IAAIC,EAAT,IAAeJ,YAAf,EAA6B;;AAE3B,UAAMK,WAAWL,aAAaI,EAAb,CAAjB;AACA,UAAI,MAAKE,SAAL,CAAeD,QAAf,CAAJ,EAA8B;AAC5B,cAAKH,oBAAL,CAA0BG,SAASE,IAAnC,IAA2CF,QAA3C;AACD;AACF;;AAbgC;AAelC;;AAED;;;;;;;;;;;;;;2CAUuBG,I,EAAMC,S,EAAWC,I,EAAM;;AAE5C,YAAM,oCAAyB,IAAzB,EAA+B,wBAA/B,CAAN;AAED;;;;;AAED;;;kCAGcF,I,EAAME,I,EAAMC,M,EAAQ;;AAEhC,UAAMC,oBAAoB,gBAAMT,WAAN,EAA1B;AACA,UAAMU,aAAaL,KAAKM,MAAxB;;AAEA,WAAK,IAAIL,SAAT,IAAsBI,UAAtB,EAAkC;;AAGhC,YAAME,OAAO,KAAKb,oBAAL,CAA0BO,SAA1B,CAAb;;AAEA,YAAI,CAACM,IAAD,IAAUJ,UAAU,CAACA,OAAOI,KAAKX,EAAZ,CAAzB,EAA2C;;AAG3C,YAAMY,SAAS,KAAKC,sBAAL,CAA4BT,IAA5B,EAAkCC,SAAlC,EAA6CC,IAA7C,CAAf;;AAEA,YAAIM,UAAUA,OAAOE,MAArB,EAA6B;AAC3BN,4BAAkBG,KAAKX,EAAvB,IAA6BY,MAA7B;AACD;AAEF;;AAED,aAAOJ,iBAAP;AAED;;;;;;AAGH;;kBAEeb,+B","file":"../../../../../felixhayashi/tiddlymap/js/edgeTypeSubscriber/AbstractMagicEdgeTypeSubscriber.js","sourcesContent":["// @preserve\n/*\\\n\ntitle: $:/plugins/felixhayashi/tiddlymap/js/AbstractMagicEdgeTypeSubscriber\ntype: application/javascript\nmodule-type: library\n\n@preserve\n\n\\*/\n\nimport utils from '$:/plugins/felixhayashi/tiddlymap/js/utils';\nimport Edge from '$:/plugins/felixhayashi/tiddlymap/js/Edge';\nimport { MissingOverrideError } from '$:/plugins/felixhayashi/tiddlymap/js/exception';\nimport AbstractRefEdgeTypeSubscriber from '$:/plugins/felixhayashi/tiddlymap/js/AbstractRefEdgeTypeSubscriber';\n\n/**\n * @constructor\n */\nclass AbstractMagicEdgeTypeSubscriber extends AbstractRefEdgeTypeSubscriber {\n\n  /**\n   * @inheritDoc\n   */\n  constructor(allEdgeTypes, options) {\n\n    super(allEdgeTypes, options);\n\n    // later used for edge retrieval to identify those fields that hold connections\n    this.edgeTypesByFieldName = utils.makeHashMap();\n\n    for (let id in allEdgeTypes) {\n\n      const edgeType = allEdgeTypes[id];\n      if (this.canHandle(edgeType)) {\n        this.edgeTypesByFieldName[edgeType.name] = edgeType;\n      }\n    }\n\n  }\n\n  /**\n   * Returns all references to other tiddlers stored in the specified tiddler.\n   *\n   * @interface\n   * @param {Tiddler} tObj - the tiddler that holds the references.\n   * @param {String} fieldName - the name of the field to get the reference from.\n   * @param {Object<TiddlerReference, boolean>} toWL - a whitelist of tiddlers that are allowed to\n   *     be included in the result.\n   * @return {Object<Id, Edge>|null}\n   */\n  getReferencesFromField(tObj, fieldName, toWL) {\n\n    throw new MissingOverrideError(this, 'getReferencesFromField');\n\n  };\n\n  /**\n   * @inheritDoc\n   */\n  getReferences(tObj, toWL, typeWL) {\n\n    const refsGroupedByType = utils.makeHashMap();\n    const fieldNames = tObj.fields;\n\n    for (let fieldName in fieldNames) {\n\n\n      const type = this.edgeTypesByFieldName[fieldName];\n\n      if (!type || (typeWL && !typeWL[type.id])) continue;\n\n\n      const toRefs = this.getReferencesFromField(tObj, fieldName, toWL);\n\n      if (toRefs && toRefs.length) {\n        refsGroupedByType[type.id] = toRefs;\n      }\n\n    }\n\n    return refsGroupedByType;\n\n  }\n}\n\n/*** Exports *******************************************************/\n\nexport default AbstractMagicEdgeTypeSubscriber;\n"],"sourceRoot":"../../../../../../src/plugins"}